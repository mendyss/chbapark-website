<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>זמני היום ופרשת השבוע</title>
    <style>
        /* CSS בסיסי כדי שייראה נחמד */
        body { font-family: Assistant, Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        h1, h2 { color: #2c3e50; }
        #location { color: #3498db; }
        ul { list-style-type: none; padding: 0; }
        li { background-color: #f9f9f9; margin-bottom: 5px; padding: 10px; border-radius: 4px; }
        li strong { color: #333; }
    </style>
</head>
<body>

    <h1>זמני היום והלכה</h1>
    <h2 id="parasha_title">טוען את פרשת השבוע...</h2>

    <hr>

    <h2>זמנים עבור <span id="location">טוען מיקום...</span></h2>
    <ul>
        <li><strong>עלות השחר:</strong> <span id="alot_hashachar">...</span></li>
        <li><strong>זריחה:</strong> <span id="sunrise">...</span></li>
        <li><strong>סוף זמן קריאת שמע:</strong> <span id="sof_zman_ksh">...</span></li>
        <li><strong>חצות היום:</strong> <span id="chatzot">...</span></li>
        <li><strong>שקיעה:</strong> <span id="sunset">...</span></li>
        <li><strong>צאת הכוכבים:</strong> <span id="tzeit_hakochavim">...</span></li>
    </ul>

    <script>
   // פונקציה זו רצה אוטומטית כשהדף נטען
document.addEventListener('DOMContentLoaded', function() {
    // קוראים לשתי הפונקציות כדי להביא את המידע
    fetchParasha();
    fetchZmanim();
});

// פונקציה להבאת והצגת פרשת השבוע
function fetchParasha() {
    const parashaUrl = 'https://www.hebcal.com/hebcal?v=1&cfg=json&maj=on&c=on';

    fetch(parashaUrl)
        .then(response => response.json())
        .then(data => {
            // הדבר הכי חשוב למפתח: לראות את המידע הגולמי שהתקבל
            console.log("תשובה גולמית עבור פרשה:", data);

            // לוגיקה משופרת: נסנן את כל הפריטים שהם פרשה, וניקח את הראשון
            const parashaItems = data.items.filter(item => item.category === 'parashat');
            
            if (parashaItems.length > 0) {
                document.getElementById('parasha_title').textContent = parashaItems[0].title;
            } else {
                document.getElementById('parasha_title').textContent = "לא נמצאה פרשה לחודש זה";
            }
        })
        .catch(error => {
            console.error('שגיאה בהבאת פרשת השבוע:', error);
            document.getElementById('parasha_title').textContent = "שגיאה בטעינת הפרשה";
        });
}

// פונקציה להבאת והצגת זמני היום
function fetchZmanim() {
    const geonameid = '295530'; // ID של באר שבע
    const zmanimUrl = `https://www.hebcal.com/zmanim?cfg=json&geonameid=${geonameid}`;

    fetch(zmanimUrl)
        .then(response => response.json())
        .then(data => {
            // הדפסת המידע הגולמי לקונסול לצורך בדיקה
            console.log("תשובה גולמית עבור זמנים:", data);

            // עדכון המיקום
            if (data.location && data.location.title) {
                document.getElementById('location').textContent = data.location.title;
            }

            // עדכון הזמנים עם בדיקה שכל שדה קיים לפני השימוש בו
            const times = data.times;
            if (times) {
                // פונקציה פנימית לעדכון בטוח של שעה
                const updateTime = (elementId, timeValue) => {
                    const element = document.getElementById(elementId);
                    if (element && timeValue) {
                        element.textContent = new Date(timeValue).toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
                    }
                };

                updateTime('alot_hashachar', times.alot_hashachar);
                updateTime('sunrise', times.sunrise);
                updateTime('sof_zman_ksh', times.sof_zman_krishm_ma);
                updateTime('chatzot', times.chatzot);
                updateTime('sunset', times.sunset);
                updateTime('tzeit_hakochavim', times.tzeit_hakochavim);
            }
        })
        .catch(error => {
            console.error('שגיאה בהבאת זמני היום:', error);
            document.getElementById('location').textContent = "שגיאה בטעינת הזמנים";
        });
}


    </script>

</body>
</html>
